<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BeeSense</title>

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Leaflet (Karte) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
</head>

<body>
  <!-- Firmenlogo (rechts oben) -->
  <div class="header-logo header-logo-right">
    <img src="assets/LogoBiene.png" alt="Insecta Systems Logo">
  </div>

  <h1>BeeSense</h1>
  <div class="subtitle">Dein smarter Bienenstock</div>

  <!-- Navigation / Reiter -->
  <div class="nav">
    <button class="nav-btn active" data-view="overview">√úbersicht</button>
    <button class="nav-btn" data-view="flights">Fl√ºge</button>
    <button class="nav-btn" data-view="temperature">Temperatur</button>
    <button class="nav-btn" data-view="humidity">Feuchtigkeit</button>
    <button class="nav-btn" data-view="location">Standort</button>
    <button class="nav-btn" data-view="settings">Einstellungen</button>
  </div>

  <!-- Ansicht: √úbersicht -->
  <div id="view-overview" class="view active">
    <div class="grid">
      <div class="card card-flight">
        <h2>Einfl√ºge</h2>
        <div class="value-row">
          <div id="einflug" class="value">0</div>
          <div class="unit">üêù ‚Üí</div>
        </div>
        <div class="small" id="einflug-info">Hummeln rein</div>
      </div>

      <div class="card card-flight">
        <h2>Ausfl√ºge</h2>
        <div class="value-row">
          <div id="ausflug" class="value">0</div>
          <div class="unit">‚Üê üêù</div>
        </div>
        <div class="small" id="ausflug-info">Hummeln raus</div>
      </div>

      <div class="card card-flight">
        <h2>Gesamt heute</h2>
        <div class="value-row">
          <div id="flights" class="value">0</div>
          <div class="unit">Fl√ºge</div>
        </div>
        <div class="small" id="flights-info">Einfl√ºge + Ausfl√ºge</div>
      </div>

      <div class="card card-temp">
        <h2>Temperatur</h2>
        <div class="value-row">
          <div id="temperature" class="value">--</div>
          <div class="unit">¬∞C</div>
        </div>
        <div class="small" id="temp-status">‚Äì</div>
      </div>

      <div class="card card-humidity">
        <h2>Luftfeuchtigkeit</h2>
        <div class="value-row">
          <div id="humidity" class="value">--</div>
          <div class="unit">%</div>
        </div>
        <div class="small" id="hum-status">‚Äì</div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Fl√ºge -->
  <div id="view-flights" class="view">
    <div class="flights-layout">
      <div class="card card-flight">
        <h2>Einfl√ºge / Ausfl√ºge heute</h2>
        <div class="value-row">
          <div id="einflug-detail" class="value">0</div>
          <div class="unit" style="margin-right: 20px;">üêù ‚Üí</div>
          <div id="ausflug-detail" class="value">0</div>
          <div class="unit">‚Üê üêù</div>
        </div>
        <div class="small">Einfl√ºge / Ausfl√ºge</div>
      </div>

      <div class="card card-flight">
        <h2>Verbindungsstatus</h2>
        <div class="value-row">
          <div id="connection-status" class="value" style="font-size: 1.2rem;">‚è≥</div>
        </div>
        <div class="small" id="last-update">Warte auf Daten...</div>
      </div>

      <div class="card card-flight">
        <h2>Fl√ºge der letzten 7 Tage</h2>
        <div class="chart-container">
          <canvas id="flightsChart"></canvas>
        </div>
        <div class="small">Flugdaten der letzten 7 Tage</div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Temperatur -->
  <div id="view-temperature" class="view">
    <div class="flights-layout">
      <div class="card card-temp">
        <h2>Aktuelle Temperatur</h2>
        <div class="value-row">
          <div id="temperature-detail" class="value">--</div>
          <div class="unit">¬∞C</div>
        </div>
        <div class="small">Momentane Temperatur im Hummelstock</div>
      </div>

      <div class="card card-temp">
        <h2>Temperatur der letzten 7 Tage (√ò)</h2>
        <div class="chart-container">
          <canvas id="tempChart"></canvas>
        </div>
        <div class="small">Durchschnittliche Temperatur pro Tag f√ºr die letzten 7 Tage</div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Feuchtigkeit -->
  <div id="view-humidity" class="view">
    <div class="flights-layout">
      <div class="card card-humidity">
        <h2>Aktuelle Luftfeuchtigkeit</h2>
        <div class="value-row">
          <div id="humidity-detail" class="value">--</div>
          <div class="unit">%</div>
        </div>
        <div class="small" id="hum-status-detail">‚Äì</div>
      </div>

      <div class="card card-humidity">
        <h2>Luftfeuchtigkeit der letzten 7 Tage (√ò)</h2>
        <div class="chart-container">
          <canvas id="humChart"></canvas>
        </div>
        <div class="small">Durchschnittliche Luftfeuchtigkeit pro Tag f√ºr die letzten 7 Tage</div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Standort -->
  <div id="view-location" class="view">
    <div class="card card-location">
      <h2>Standorte der St√∂cke</h2>

      <div class="location-layout">
        <!-- linke Seite -->
        <div>
          <p class="location-coords">
            Hier kann der Imker bis zu <strong>5 St√∂cke</strong> (Name + Koordinaten) speichern und auf der Karte anzeigen lassen.
          </p>

          <form class="location-form" onsubmit="return false;">
            <label>
              Name (z.B. Bienenstock1):<br />
              <input type="text" id="input-name" placeholder="z.B. Bienenstock1" maxlength="30" />
            </label>

            <label>
              Breite (Lat):<br />
              <input type="number" step="0.0001" id="input-lat" placeholder="z.B. 52.5200" />
            </label>

            <label>
              L√§nge (Lng):<br />
              <input type="number" step="0.0001" id="input-lng" placeholder="z.B. 13.4050" />
            </label>

            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button id="btn-save-stock" type="button">Speichern</button>
              <button id="btn-show-current" type="button">Anzeigen</button>
              <button id="btn-clear-stocks" type="button">Alle l√∂schen</button>
            </div>

            <div class="small" id="stock-msg" style="margin-top:6px;">‚Äì</div>
          </form>

          <h3 style="margin-top:14px; margin-bottom:6px;">Gespeicherte St√∂cke</h3>
          <div id="stocks-list" class="stocks-list"></div>
        </div>

        <!-- rechte Seite: Karte -->
        <div>
          <div id="map" class="map-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Einstellungen -->
  <div id="view-settings" class="view">
    <div class="card card-settings">
      <h2>Einstellungen</h2>
      <p class="placeholder">
        Hier kannst du zuk√ºnftig Parameter, Warnschwellen, Sensoroptionen usw. einstellen.
      </p>

      <div class="small" style="margin-top: 10px;">Darstellung:</div>
      <button id="theme-toggle" class="theme-toggle">Dunkles Design</button>
    </div>
  </div>

  <script>
    // ---------------------------------------
    // Navigation / Reiter
    // ---------------------------------------
    const navButtons = document.querySelectorAll(".nav-btn");
    const views = {
      overview: document.getElementById("view-overview"),
      flights: document.getElementById("view-flights"),
      temperature: document.getElementById("view-temperature"),
      humidity: document.getElementById("view-humidity"),
      location: document.getElementById("view-location"),
      settings: document.getElementById("view-settings"),
    };

    let map = null;

    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.view;

        navButtons.forEach(b => b.classList.toggle("active", b === btn));
        Object.entries(views).forEach(([name, el]) => {
          el.classList.toggle("active", name === target);
        });

        if (target === "location" && map) {
          setTimeout(() => map.invalidateSize(), 100);
        }
      });
    });

    // ---------------------------------------
    // Theme Toggle (Hell/Dunkel) in Einstellungen
    // ---------------------------------------
    const themeToggleBtn = document.getElementById("theme-toggle");

    function applyTheme(theme) {
      if (theme === "dark") {
        document.body.classList.add("theme-dark");
        if (themeToggleBtn) themeToggleBtn.textContent = "Helles Design";
      } else {
        document.body.classList.remove("theme-dark");
        if (themeToggleBtn) themeToggleBtn.textContent = "Dunkles Design";
      }
      localStorage.setItem("beeTheme", theme);
    }

    const savedTheme = localStorage.getItem("beeTheme") || "light";
    applyTheme(savedTheme);

    if (themeToggleBtn) {
      themeToggleBtn.addEventListener("click", () => {
        const isDark = document.body.classList.contains("theme-dark");
        applyTheme(isDark ? "light" : "dark");
      });
    }

    // ---------------------------------------
    // Historische Daten f√ºr 7 Tage (ohne heute)
    // ---------------------------------------
    let labelsLast7 = [];
    let flightsLast7 = [];
    let tempLast7 = [];
    let humLast7 = [];

    for (let i = 7; i >= 1; i--) {
      const d = new Date();
      d.setDate(d.getDate() - i);

      labelsLast7.push(
        d.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" })
      );

      flightsLast7.push(0);
      tempLast7.push(null);
      humLast7.push(null);
    }

    // ---------------------------------------
    // Diagramm Fl√ºge (Balken)
    // ---------------------------------------
    const ctxFlights = document.getElementById("flightsChart").getContext("2d");
    const flightsChart = new Chart(ctxFlights, {
      type: "bar",
      data: {
        labels: labelsLast7,
        datasets: [
          { label: "Fl√ºge pro Tag", data: flightsLast7 },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, ticks: { stepSize: 20 } },
        },
      },
    });

    // ---------------------------------------
    // Diagramm Temperatur (Linie)
    // ---------------------------------------
    const ctxTemp = document.getElementById("tempChart").getContext("2d");
    const tempChart = new Chart(ctxTemp, {
      type: "line",
      data: {
        labels: labelsLast7,
        datasets: [
          {
            label: "√ò Temperatur pro Tag (¬∞C)",
            data: tempLast7,
            tension: 0.3,
            fill: false,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: false },
        },
      },
    });

    // ---------------------------------------
    // Diagramm Luftfeuchtigkeit (Linie)
    // ---------------------------------------
    const ctxHum = document.getElementById("humChart").getContext("2d");
    const humChart = new Chart(ctxHum, {
      type: "line",
      data: {
        labels: labelsLast7,
        datasets: [
          {
            label: "√ò Luftfeuchtigkeit pro Tag (%)",
            data: humLast7,
            tension: 0.3,
            fill: false,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: false,
            suggestedMin: 30,
            suggestedMax: 90,
          },
        },
      },
    });

    // ---------------------------------------
    // Funktion zum Aktualisieren der Diagramme mit echten Daten
    // ---------------------------------------
    function updateChartsWithHistoricalData() {
      fetch("/api/history")
        .then(res => res.json())
        .then(data => {
          console.log("Historische Daten geladen:", data);
          
          // Flugdaten aktualisieren
          if (data.flights && data.flights.length > 0) {
            const flightLabels = [];
            const flightData = [];
            data.flights.forEach(day => {
              const date = new Date(day.date);
              flightLabels.push(date.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" }));
              flightData.push(day.total);
            });
            flightsChart.data.labels = flightLabels;
            flightsChart.data.datasets[0].data = flightData;
            flightsChart.update();
          }
          
          // Temperaturdaten aktualisieren
          if (data.temperature && data.temperature.length > 0) {
            const tempLabels = [];
            const tempData = [];
            data.temperature.forEach(day => {
              const date = new Date(day.date);
              tempLabels.push(date.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" }));
              tempData.push(parseFloat(day.avg.toFixed(1)));
            });
            tempChart.data.labels = tempLabels;
            tempChart.data.datasets[0].data = tempData;
            tempChart.update();
          }
          
          // Feuchtigkeitsdaten aktualisieren
          if (data.humidity && data.humidity.length > 0) {
            const humLabels = [];
            const humData = [];
            data.humidity.forEach(day => {
              const date = new Date(day.date);
              humLabels.push(date.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" }));
              humData.push(parseFloat(day.avg.toFixed(1)));
            });
            humChart.data.labels = humLabels;
            humChart.data.datasets[0].data = humData;
            humChart.update();
          }
        })
        .catch(err => {
          console.log("Keine historischen Daten verf√ºgbar", err);
        });
    }

    // Initial laden und dann alle 30 Sekunden aktualisieren
    updateChartsWithHistoricalData();
    setInterval(updateChartsWithHistoricalData, 30000);

    // ---------------------------------------
    // Leaflet-Karte & Stock-Verwaltung (bis zu 5)
    // ---------------------------------------
    const STOCKS_KEY = "beeStocks_v1";
    const MAX_STOCKS = 5;

    const nameInput = document.getElementById("input-name");
    const latInputEl = document.getElementById("input-lat");
    const lngInputEl = document.getElementById("input-lng");
    const msgEl = document.getElementById("stock-msg");
    const listEl = document.getElementById("stocks-list");

    function setMsg(text) {
      if (msgEl) msgEl.innerText = text;
    }

    function loadStocks() {
      try {
        const raw = localStorage.getItem(STOCKS_KEY);
        const parsed = raw ? JSON.parse(raw) : [];
        return Array.isArray(parsed) ? parsed : [];
      } catch {
        return [];
      }
    }

    function saveStocks(stocks) {
      localStorage.setItem(STOCKS_KEY, JSON.stringify(stocks));
    }

    function normalizeName(name) {
      return (name || "").trim().replace(/\s+/g, " ");
    }

    function isValidLatLng(lat, lng) {
      return Number.isFinite(lat) && Number.isFinite(lng) &&
        lat >= -90 && lat <= 90 && lng >= -180 && lng <= 180;
    }

    function upsertStock(stock) {
      const stocks = loadStocks();
      const idx = stocks.findIndex(s => s.name.toLowerCase() === stock.name.toLowerCase());

      if (idx >= 0) {
        stocks[idx] = stock;
        saveStocks(stocks);
        return { ok: true, msg: `‚Äû${stock.name}‚Äú aktualisiert.` };
      }

      if (stocks.length >= MAX_STOCKS) {
        return { ok: false, msg: `Maximal ${MAX_STOCKS} St√∂cke erlaubt. Bitte erst einen l√∂schen.` };
      }

      stocks.push(stock);
      saveStocks(stocks);
      return { ok: true, msg: `‚Äû${stock.name}‚Äú gespeichert.` };
    }

    function deleteStockByName(name) {
      const stocks = loadStocks().filter(s => s.name.toLowerCase() !== name.toLowerCase());
      saveStocks(stocks);
    }

    function clearAllStocks() {
      localStorage.removeItem(STOCKS_KEY);
    }

    // Karte initialisieren
    const initialStocks = loadStocks();
    let currentLat = initialStocks[0]?.lat ?? 52.5200;
    let currentLng = initialStocks[0]?.lng ?? 13.4050;

    map = L.map("map").setView([currentLat, currentLng], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "¬© OpenStreetMap-Mitwirkende"
    }).addTo(map);

    const marker = L.marker([currentLat, currentLng])
      .addTo(map)
      .bindPopup("Stock-Standort")
      .openPopup();

    function showOnMap(lat, lng, popupText = "Stock-Standort") {
      map.setView([lat, lng], 13);
      marker.setLatLng([lat, lng]);
      marker.bindPopup(popupText).openPopup();
    }

    function renderStocks() {
      const stocks = loadStocks();
      if (!listEl) return;

      if (stocks.length === 0) {
        listEl.innerHTML = `<div class="small">Noch keine St√∂cke gespeichert.</div>`;
        return;
      }

      listEl.innerHTML = "";

      stocks.forEach(stock => {
        const item = document.createElement("div");
        item.className = "stock-item";

        const left = document.createElement("div");
        left.innerHTML = `
          <div class="stock-name">${stock.name}</div>
          <div class="stock-meta">${stock.lat.toFixed(4)}, ${stock.lng.toFixed(4)}</div>
        `;

        const actions = document.createElement("div");
        actions.className = "stock-actions";

        const btnShow = document.createElement("button");
        btnShow.className = "btn-show";
        btnShow.type = "button";
        btnShow.innerText = "Anzeigen";
        btnShow.addEventListener("click", () => {
          showOnMap(stock.lat, stock.lng, stock.name);

          if (nameInput) nameInput.value = stock.name;
          if (latInputEl) latInputEl.value = stock.lat.toFixed(4);
          if (lngInputEl) lngInputEl.value = stock.lng.toFixed(4);

          setMsg(`‚Äû${stock.name}‚Äú auf Karte angezeigt.`);
        });

        const btnDel = document.createElement("button");
        btnDel.className = "btn-delete";
        btnDel.type = "button";
        btnDel.innerText = "L√∂schen";
        btnDel.addEventListener("click", () => {
          deleteStockByName(stock.name);
          renderStocks();
          setMsg(`‚Äû${stock.name}‚Äú gel√∂scht.`);
        });

        actions.appendChild(btnShow);
        actions.appendChild(btnDel);

        item.appendChild(left);
        item.appendChild(actions);
        listEl.appendChild(item);
      });
    }

    document.getElementById("btn-save-stock")?.addEventListener("click", () => {
      const name = normalizeName(nameInput?.value);
      const lat = parseFloat(latInputEl?.value);
      const lng = parseFloat(lngInputEl?.value);

      if (!name) {
        setMsg("Bitte einen Namen eingeben (z.B. Bienenstock1).");
        return;
      }
      if (!isValidLatLng(lat, lng)) {
        setMsg("Bitte g√ºltige Koordinaten eingeben (Lat: -90..90, Lng: -180..180).");
        return;
      }

      const result = upsertStock({ name, lat, lng, updatedAt: Date.now() });
      setMsg(result.msg);

      if (result.ok) {
        renderStocks();
        showOnMap(lat, lng, name);
      }
    });

    document.getElementById("btn-show-current")?.addEventListener("click", () => {
      const name = normalizeName(nameInput?.value) || "Stock-Standort";
      const lat = parseFloat(latInputEl?.value);
      const lng = parseFloat(lngInputEl?.value);

      if (!isValidLatLng(lat, lng)) {
        setMsg("Bitte g√ºltige Koordinaten eingeben, um den Standort anzuzeigen.");
        return;
      }

      showOnMap(lat, lng, name);
      setMsg(`‚Äû${name}‚Äú auf Karte angezeigt (nicht gespeichert).`);
    });

    document.getElementById("btn-clear-stocks")?.addEventListener("click", () => {
      clearAllStocks();
      renderStocks();
      setMsg("Alle gespeicherten St√∂cke wurden gel√∂scht.");
    });

    renderStocks();
    setMsg("‚Äì");

    // ---------------------------------------
    // ESP32 Live-Daten (Server-Sent Events)
    // ---------------------------------------
    let einflug = 0;
    let ausflug = 0;
    let isConnected = false;

    function updateUI(data) {
      einflug = data.einflug || 0;
      ausflug = data.ausflug || 0;
      const total = einflug + ausflug;

      // √úbersicht
      document.getElementById("einflug").innerText = einflug;
      document.getElementById("ausflug").innerText = ausflug;
      document.getElementById("flights").innerText = total;

      // Detailseite
      const einflugDetail = document.getElementById("einflug-detail");
      const ausflugDetail = document.getElementById("ausflug-detail");
      if (einflugDetail) einflugDetail.innerText = einflug;
      if (ausflugDetail) ausflugDetail.innerText = ausflug;

      // Letztes Update
      if (data.lastUpdate) {
        const time = new Date(data.lastUpdate).toLocaleTimeString("de-DE");
        const lastUpdateEl = document.getElementById("last-update");
        if (lastUpdateEl) lastUpdateEl.innerText = `Letztes Update: ${time}`;
      }
    }

    function setConnectionStatus(connected) {
      isConnected = connected;
      const statusEl = document.getElementById("connection-status");
      if (statusEl) {
        statusEl.innerText = connected ? "‚úÖ Verbunden" : "‚ùå Getrennt";
        statusEl.style.color = connected ? "#22c55e" : "#ef4444";
      }
    }

    function connectToServer() {
      console.log("Verbinde mit Server...");
      setConnectionStatus(false);

      const evtSource = new EventSource("/api/events");

      evtSource.onopen = () => {
        console.log("SSE Verbindung hergestellt");
        setConnectionStatus(true);
      };

      evtSource.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          console.log("Daten empfangen:", data);
          updateUI(data);
          setConnectionStatus(true);
        } catch (e) {
          console.error("Fehler beim Parsen:", e);
        }
      };

      evtSource.onerror = (err) => {
        console.error("SSE Fehler:", err);
        setConnectionStatus(false);
        evtSource.close();
        // Reconnect nach 3 Sekunden
        setTimeout(connectToServer, 3000);
      };
    }

    // Initiale Daten laden
    fetch("/api/tracking")
      .then(res => res.json())
      .then(data => {
        updateUI(data);
        setConnectionStatus(true);
      })
      .catch(err => {
        console.log("Server nicht erreichbar, verwende Simulation");
        setConnectionStatus(false);
      });

    // Live-Verbindung starten
    connectToServer();

    // ---------------------------------------
    // Temperatur/Feuchtigkeit von API
    // ---------------------------------------
    function updateSensorData(sensorData) {
      const temp = sensorData.temperature;
      const hum = sensorData.humidity;

      if (temp !== null && temp !== undefined) {
        document.getElementById("temperature").innerText = temp.toFixed(1);
        document.getElementById("temperature-detail").innerText = temp.toFixed(1);

        // Status Temperatur
        const tempStatus = document.getElementById("temp-status");
        if (temp >= 24 && temp <= 32) {
          tempStatus.innerText = "Temperatur im guten Bereich";
          tempStatus.className = "small status-ok";
        } else {
          tempStatus.innerText = "Temperatur au√üerhalb Optimalbereich";
          tempStatus.className = "small status-warn";
        }
      }

      if (hum !== null && hum !== undefined) {
        document.getElementById("humidity").innerText = hum.toFixed(1);
        const humidityDetail = document.getElementById("humidity-detail");
        if (humidityDetail) humidityDetail.innerText = hum.toFixed(1);

        // Status Luftfeuchtigkeit
        const humStatus = document.getElementById("hum-status");
        if (hum >= 50 && hum <= 80) {
          humStatus.innerText = "Luftfeuchtigkeit im guten Bereich";
          humStatus.className = "small status-ok";
        } else {
          humStatus.innerText = "Luftfeuchtigkeit au√üerhalb Optimalbereich";
          humStatus.className = "small status-warn";
        }

        // Status in Detailseite √ºbernehmen
        const humStatusDetailEl = document.getElementById("hum-status-detail");
        if (humStatus && humStatusDetailEl) {
          humStatusDetailEl.innerText = humStatus.innerText;
          humStatusDetailEl.className = humStatus.className;
        }
      }
    }

    // Sensor-Daten initial laden
    fetch("/api/sensors")
      .then(res => res.json())
      .then(data => {
        console.log("Sensor-Daten geladen:", data);
        updateSensorData(data);
      })
      .catch(err => {
        console.log("Keine Sensor-Daten verf√ºgbar");
      });

    // Sensor-Daten regelm√§√üig aktualisieren
    setInterval(() => {
      fetch("/api/sensors")
        .then(res => res.json())
        .then(data => updateSensorData(data))
        .catch(err => console.log("Fehler beim Laden der Sensor-Daten"));
    }, 5000);
  </script>
</body>
</html>