<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hummelstock Dashboard (PC-Simulation)</title>

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Leaflet (Karte) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
</head>
<body>
  <!-- Firmenlogo (rechts oben) -->
  <div class="header-logo header-logo-right">
    <img src="assets/insecta-logo.png" alt="Insecta Systems Logo">
  </div>

  <h1>Hummelstock Dashboard</h1>
  <div class="subtitle">
    PC-Simulation ohne ESP32 â€“ FlÃ¼ge, Temperatur und Luftfeuchtigkeit.
  </div>

  <!-- Navigation / Reiter -->
  <div class="nav">
    <button class="nav-btn active" data-view="overview">Ãœbersicht</button>
    <button class="nav-btn" data-view="flights">FlÃ¼ge</button>
    <button class="nav-btn" data-view="temperature">Temperatur</button>
    <button class="nav-btn" data-view="humidity">Feuchtigkeit</button>
    <button class="nav-btn" data-view="location">Standort</button>
    <button class="nav-btn" data-view="settings">Einstellungen</button>
  </div>

  <!-- Ansicht: Ãœbersicht -->
  <div id="view-overview" class="view active">
    <div class="grid">
      <div class="card card-flight">
        <h2>FlÃ¼ge heute</h2>
        <div class="value-row">
          <div id="flights" class="value">0</div>
          <div class="unit">FlÃ¼ge</div>
        </div>
        <div class="small" id="flights-info">simulierte ZÃ¤hlung</div>
      </div>

      <div class="card card-temp">
        <h2>Temperatur</h2>
        <div class="value-row">
          <div id="temperature" class="value">--</div>
          <div class="unit">Â°C</div>
        </div>
        <div class="small" id="temp-status">â€“</div>
      </div>

      <div class="card card-humidity">
        <h2>Luftfeuchtigkeit</h2>
        <div class="value-row">
          <div id="humidity" class="value">--</div>
          <div class="unit">%</div>
        </div>
        <div class="small" id="hum-status">â€“</div>
      </div>
    </div>
  </div>

  <!-- Ansicht: FlÃ¼ge -->
  <div id="view-flights" class="view">
    <div class="flights-layout">
      <div class="card card-flight">
        <h2>FlÃ¼ge heute</h2>
        <div class="value-row">
          <div id="flights-detail" class="value">0</div>
          <div class="unit">FlÃ¼ge</div>
        </div>
        <div class="small">
          Heutige FlÃ¼ge (laufende ZÃ¤hlung).
        </div>
      </div>

      <div class="card card-flight">
        <h2>FlÃ¼ge der letzten 7 Tage (ohne heute)</h2>
        <div class="chart-container">
          <canvas id="flightsChart"></canvas>
        </div>
        <div class="small">
          Simulierte Flugdaten der letzten 7 Tage.
        </div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Temperatur -->
  <div id="view-temperature" class="view">
    <div class="flights-layout">
      <div class="card card-temp">
        <h2>Aktuelle Temperatur</h2>
        <div class="value-row">
          <div id="temperature-detail" class="value">--</div>
          <div class="unit">Â°C</div>
        </div>
        <div class="small">
          Momentane Temperatur im Hummelstock (simuliert).
        </div>
      </div>

      <div class="card card-temp">
        <h2>Temperatur der letzten 7 Tage (Ã˜, ohne heute)</h2>
        <div class="chart-container">
          <canvas id="tempChart"></canvas>
        </div>
        <div class="small">
          Durchschnittliche Temperatur pro Tag fÃ¼r die letzten 7 Tage vor heute.
        </div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Feuchtigkeit -->
  <div id="view-humidity" class="view">
    <div class="flights-layout">
      <div class="card card-humidity">
        <h2>Aktuelle Luftfeuchtigkeit</h2>
        <div class="value-row">
          <div id="humidity-detail" class="value">--</div>
          <div class="unit">%</div>
        </div>
        <div class="small" id="hum-status-detail">â€“</div>
      </div>

      <div class="card card-humidity">
        <h2>Luftfeuchtigkeit der letzten 7 Tage (Ã˜, ohne heute)</h2>
        <div class="chart-container">
          <canvas id="humChart"></canvas>
        </div>
        <div class="small">
          Durchschnittliche Luftfeuchtigkeit pro Tag fÃ¼r die letzten 7 Tage vor heute.
        </div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Standort -->
  <div id="view-location" class="view">
    <div class="card card-location">
      <h2>Standort des Hummelstocks</h2>

      <div class="location-layout">
        <!-- linke Seite -->
        <div>
          <p class="location-coords">
            Der Imker kann hier den Standort des Stocks Ã¼ber Koordinaten eintragen.
            <br><br>
            Aktuelle Koordinaten:
            <br>
            <strong>Breite:</strong> <span id="location-lat">52.5200</span>Â° N<br>
            <strong>LÃ¤nge:</strong> <span id="location-lng">13.4050</span>Â° E
          </p>

          <form class="location-form" onsubmit="return false;">
            <label>
              Breite (Lat):<br />
              <input type="number" step="0.0001" id="input-lat" placeholder="z.B. 52.5200" />
            </label>

            <label>
              LÃ¤nge (Lng):<br />
              <input type="number" step="0.0001" id="input-lng" placeholder="z.B. 13.4050" />
            </label>

            <button id="btn-update-location">Standort aktualisieren</button>
          </form>
        </div>

        <!-- rechte Seite: Karte -->
        <div>
          <div id="map" class="map-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Einstellungen -->
  <div id="view-settings" class="view">
    <div class="card card-settings">
      <h2>Einstellungen</h2>
      <p class="placeholder">
        Hier kannst du zukÃ¼nftig Parameter, Warnschwellen, Sensoroptionen usw. einstellen.
      </p>

      <div class="small" style="margin-top: 10px;">
        Darstellung:
      </div>
      <button id="theme-toggle" class="theme-toggle">
        ðŸŒ™ Dunkles Design aktivieren
      </button>
    </div>
  </div>

  <script>
    // ---------------------------------------
    // Navigation / Reiter
    // ---------------------------------------
    const navButtons = document.querySelectorAll(".nav-btn");
    const views = {
      overview: document.getElementById("view-overview"),
      flights: document.getElementById("view-flights"),
      temperature: document.getElementById("view-temperature"),
      humidity: document.getElementById("view-humidity"),
      location: document.getElementById("view-location"),
      settings: document.getElementById("view-settings"),
    };

    let map = null;

    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.view;
        navButtons.forEach(b => b.classList.toggle("active", b === btn));
        Object.entries(views).forEach(([name, el]) => {
          el.classList.toggle("active", name === target);
        });

        if (target === "location" && map) {
          setTimeout(() => map.invalidateSize(), 100);
        }
      });
    });

    // ---------------------------------------
    // Theme Toggle (Hell/Dunkel) in Einstellungen
    // ---------------------------------------
    const themeToggleBtn = document.getElementById("theme-toggle");

    function applyTheme(theme) {
      if (theme === "dark") {
        document.body.classList.add("theme-dark");
        if (themeToggleBtn) themeToggleBtn.textContent = "â˜€ï¸ Helles Design aktivieren";
      } else {
        document.body.classList.remove("theme-dark");
        if (themeToggleBtn) themeToggleBtn.textContent = "ðŸŒ™ Dunkles Design aktivieren";
      }
      localStorage.setItem("beeTheme", theme);
    }

    const savedTheme = localStorage.getItem("beeTheme") || "light";
    applyTheme(savedTheme);

    if (themeToggleBtn) {
      themeToggleBtn.addEventListener("click", () => {
        const isDark = document.body.classList.contains("theme-dark");
        applyTheme(isDark ? "light" : "dark");
      });
    }

    // ---------------------------------------
    // Simulationsdaten (heute)
    // ---------------------------------------
    let flights = 0;
    let temp = 24.0;
    let hum = 60.0;

    // ---------------------------------------
    // Historische Daten fÃ¼r 7 Tage (ohne heute)
    // ---------------------------------------
    let labelsLast7 = [];
    let flightsLast7 = [];
    let tempLast7 = [];
    let humLast7 = [];

    for (let i = 7; i >= 1; i--) {
      const d = new Date();
      d.setDate(d.getDate() - i);
      labelsLast7.push(
        d.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" })
      );

      flightsLast7.push(80 + Math.floor(Math.random() * 100)); // 80â€“180
      tempLast7.push(22 + Math.random() * 8);                  // 22â€“30 Â°C
      humLast7.push(50 + Math.random() * 30);                  // 50â€“80 %
    }

    // ---------------------------------------
    // Diagramm FlÃ¼ge (Balken)
    // ---------------------------------------
    const ctxFlights = document.getElementById("flightsChart").getContext("2d");
    const flightsChart = new Chart(ctxFlights, {
      type: "bar",
      data: {
        labels: labelsLast7,
        datasets: [
          {
            label: "FlÃ¼ge pro Tag",
            data: flightsLast7,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, ticks: { stepSize: 20 } },
        },
      },
    });

    // ---------------------------------------
    // Diagramm Temperatur (Linie)
    // ---------------------------------------
    const ctxTemp = document.getElementById("tempChart").getContext("2d");
    const tempChart = new Chart(ctxTemp, {
      type: "line",
      data: {
        labels: labelsLast7,
        datasets: [
          {
            label: "Ã˜ Temperatur pro Tag (Â°C)",
            data: tempLast7,
            tension: 0.3,
            fill: false,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: false },
        },
      },
    });

    // ---------------------------------------
    // Diagramm Luftfeuchtigkeit (Linie)
    // ---------------------------------------
    const ctxHum = document.getElementById("humChart").getContext("2d");
    const humChart = new Chart(ctxHum, {
      type: "line",
      data: {
        labels: labelsLast7,
        datasets: [
          {
            label: "Ã˜ Luftfeuchtigkeit pro Tag (%)",
            data: humLast7,
            tension: 0.3,
            fill: false,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: false,
            suggestedMin: 30,
            suggestedMax: 90
          },
        },
      },
    });

    // ---------------------------------------
    // Leaflet-Karte & Standort-Eingabe
    // ---------------------------------------
    const storedLat = localStorage.getItem("beeLocationLat");
    const storedLng = localStorage.getItem("beeLocationLng");

    let currentLat = storedLat ? parseFloat(storedLat) : 52.5200;
    let currentLng = storedLng ? parseFloat(storedLng) : 13.4050;

    document.getElementById("location-lat").innerText = currentLat.toFixed(4);
    document.getElementById("location-lng").innerText = currentLng.toFixed(4);
    document.getElementById("input-lat").value = currentLat.toFixed(4);
    document.getElementById("input-lng").value = currentLng.toFixed(4);

    map = L.map("map").setView([currentLat, currentLng], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "Â© OpenStreetMap-Mitwirkende"
    }).addTo(map);

    const marker = L.marker([currentLat, currentLng])
      .addTo(map)
      .bindPopup("Hummelstock-Standort")
      .openPopup();

    document.getElementById("btn-update-location").addEventListener("click", () => {
      const latInput = parseFloat(document.getElementById("input-lat").value);
      const lngInput = parseFloat(document.getElementById("input-lng").value);

      if (isNaN(latInput) || isNaN(lngInput)) {
        alert("Bitte gÃ¼ltige Zahlen fÃ¼r Breite und LÃ¤nge eingeben.");
        return;
      }

      currentLat = latInput;
      currentLng = lngInput;

      map.setView([currentLat, currentLng], 13);
      marker.setLatLng([currentLat, currentLng]);

      document.getElementById("location-lat").innerText = currentLat.toFixed(4);
      document.getElementById("location-lng").innerText = currentLng.toFixed(4);

      localStorage.setItem("beeLocationLat", currentLat.toFixed(4));
      localStorage.setItem("beeLocationLng", currentLng.toFixed(4));
    });

    // ---------------------------------------
    // UI updaten (Simulation der aktuellen Werte)
    // ---------------------------------------
    function updateSimulatedData() {
      flights += Math.floor(Math.random() * 4);
      temp += (Math.random() - 0.5) * 0.4;
      hum += (Math.random() - 0.5) * 1.0;

      if (temp < 15) temp = 15;
      if (temp > 35) temp = 35;
      if (hum < 30) hum = 30;
      if (hum > 90) hum = 90;

      // Ãœbersicht
      document.getElementById("flights").innerText = flights;
      document.getElementById("temperature").innerText = temp.toFixed(1);
      document.getElementById("humidity").innerText = hum.toFixed(1);

      // Detailseiten
      document.getElementById("flights-detail").innerText = flights;
      document.getElementById("temperature-detail").innerText = temp.toFixed(1);

      const humidityDetail = document.getElementById("humidity-detail");
      if (humidityDetail) humidityDetail.innerText = hum.toFixed(1);

      // Status Temperatur
      const tempStatus = document.getElementById("temp-status");
      if (temp >= 24 && temp <= 32) {
        tempStatus.innerText = "Temperatur im guten Bereich";
        tempStatus.className = "small status-ok";
      } else {
        tempStatus.innerText = "Temperatur auÃŸerhalb Optimalbereich";
        tempStatus.className = "small status-warn";
      }

      // Status Luftfeuchtigkeit
      const humStatus = document.getElementById("hum-status");
      if (hum >= 50 && hum <= 80) {
        humStatus.innerText = "Luftfeuchtigkeit im guten Bereich";
        humStatus.className = "small status-ok";
      } else {
        humStatus.innerText = "Luftfeuchtigkeit auÃŸerhalb Optimalbereich";
        humStatus.className = "small status-warn";
      }

      // Status in Detailseite Ã¼bernehmen
      const humStatusDetailEl = document.getElementById("hum-status-detail");
      if (humStatus && humStatusDetailEl) {
        humStatusDetailEl.innerText = humStatus.innerText;
        humStatusDetailEl.className = humStatus.className;
      }
    }

    setInterval(updateSimulatedData, 2000);
    updateSimulatedData();
  </script>
</body>
</html>
