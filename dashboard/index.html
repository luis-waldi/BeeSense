<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hummelstock Dashboard (PC-Simulation)</title>

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Leaflet (Karte) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
</head>
<body>
  <h1>Hummelstock Dashboard</h1>
  <div class="subtitle">
    PC-Simulation ohne ESP32 – Flüge, Temperatur und Luftfeuchtigkeit.
  </div>

  <!-- Navigation / Reiter -->
  <div class="nav">
    <button class="nav-btn active" data-view="overview">Übersicht</button>
    <button class="nav-btn" data-view="flights">Flüge</button>
    <button class="nav-btn" data-view="temperature">Temperatur</button>
    <button class="nav-btn" data-view="humidity">Feuchtigkeit</button>
    <button class="nav-btn" data-view="location">Standort</button>
    <button class="nav-btn" data-view="settings">Einstellungen</button>
  </div>

  <!-- Ansicht: Übersicht -->
  <div id="view-overview" class="view active">
    <div class="grid">
      <div class="card card-flight">
        <h2>Flüge heute</h2>
        <div class="value-row">
          <div id="flights" class="value">0</div>
          <div class="unit">Flüge</div>
        </div>
        <div class="small" id="flights-info">simulierte Zählung</div>
      </div>

      <div class="card card-temp">
        <h2>Temperatur</h2>
        <div class="value-row">
          <div id="temperature" class="value">--</div>
          <div class="unit">°C</div>
        </div>
        <div class="small" id="temp-status">–</div>
      </div>

      <div class="card card-humidity">
        <h2>Luftfeuchtigkeit</h2>
        <div class="value-row">
          <div id="humidity" class="value">--</div>
          <div class="unit">%</div>
        </div>
        <div class="small" id="hum-status">–</div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Flüge -->
  <div id="view-flights" class="view">
    <div class="flights-layout">
      <div class="card card-flight">
        <h2>Flüge heute</h2>
        <div class="value-row">
          <div id="flights-detail" class="value">0</div>
          <div class="unit">Flüge</div>
        </div>
        <div class="small">
          Heutige Flüge (laufende Zählung).
        </div>
      </div>

      <div class="card card-flight">
        <h2>Flüge der letzten 7 Tage (ohne heute)</h2>
        <div class="chart-container">
          <canvas id="flightsChart"></canvas>
        </div>
        <div class="small">
          Simulierte Flugdaten der letzten 7 Tage.
        </div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Temperatur -->
  <div id="view-temperature" class="view">
    <div class="flights-layout">
      <div class="card card-temp">
        <h2>Aktuelle Temperatur</h2>
        <div class="value-row">
          <div id="temperature-detail" class="value">--</div>
          <div class="unit">°C</div>
        </div>
        <div class="small">
          Momentane Temperatur im Hummelstock (simuliert).
        </div>
      </div>

      <div class="card card-temp">
        <h2>Temperatur der letzten 7 Tage (Ø, ohne heute)</h2>
        <div class="chart-container">
          <canvas id="tempChart"></canvas>
        </div>
        <div class="small">
          Durchschnittliche Temperatur pro Tag für die letzten 7 Tage vor heute.
        </div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Feuchtigkeit -->
  <div id="view-humidity" class="view">
    <div class="card card-humidity">
      <h2>Feuchtigkeit – Detailansicht</h2>
      <p class="placeholder">
        Hier kommen später Verlaufskurven und Schwellwertinformationen hin.
      </p>
    </div>
  </div>

  <!-- Ansicht: Standort -->
  <div id="view-location" class="view">
    <div class="card card-location">
      <h2>Standort des Hummelstocks</h2>

      <div class="location-layout">
        <!-- linke Seite -->
        <div>
          <p class="location-coords">
            Der Imker kann hier den Standort des Stocks über Koordinaten eintragen.
            <br><br>
            Aktuelle Koordinaten:
            <br>
            <strong>Breite:</strong> <span id="location-lat">52.5200</span>° N<br>
            <strong>Länge:</strong> <span id="location-lng">13.4050</span>° E
          </p>

          <form class="location-form" onsubmit="return false;">
            <label>
              Breite (Lat):<br />
              <input type="number" step="0.0001" id="input-lat" placeholder="z.B. 52.5200" />
            </label>

            <label>
              Länge (Lng):<br />
              <input type="number" step="0.0001" id="input-lng" placeholder="z.B. 13.4050" />
            </label>

            <button id="btn-update-location">Standort aktualisieren</button>
          </form>
        </div>

        <!-- rechte Seite: Karte -->
        <div>
          <div id="map" class="map-container"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ansicht: Einstellungen -->
  <div id="view-settings" class="view">
    <div class="card card-settings">
      <h2>Einstellungen</h2>
      <p class="placeholder">
        Hier kannst du zukünftig Parameter, Warnschwellen, Sensoroptionen usw. einstellen.
      </p>
    </div>
  </div>

  <script>
    // ---------------------------------------
    // Navigation / Reiter
    // ---------------------------------------
    const navButtons = document.querySelectorAll(".nav-btn");
    const views = {
      overview: document.getElementById("view-overview"),
      flights: document.getElementById("view-flights"),
      temperature: document.getElementById("view-temperature"),
      humidity: document.getElementById("view-humidity"),
      location: document.getElementById("view-location"),
      settings: document.getElementById("view-settings"),
    };

    let map = null;

    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.view;
        navButtons.forEach(b => b.classList.toggle("active", b === btn));
        Object.entries(views).forEach(([name, el]) => {
          el.classList.toggle("active", name === target);
        });

        if (target === "location" && map) {
          setTimeout(() => {
            map.invalidateSize();
          }, 100);
        }
      });
    });

    // ---------------------------------------
    // Simulationsdaten (heute)
    // ---------------------------------------
    let flights = 0;
    let temp = 24.0;
    let hum = 60.0;

    // ---------------------------------------
    // Historische Daten für 7 Tage (ohne heute)
    // ---------------------------------------
    let labelsLast7 = [];
    let flightsLast7 = [];
    let tempLast7 = [];

    for (let i = 7; i >= 1; i--) {
      const d = new Date();
      d.setDate(d.getDate() - i);
      labelsLast7.push(
        d.toLocaleDateString("de-DE", { day: "2-digit", month: "2-digit" })
      );

      flightsLast7.push(80 + Math.floor(Math.random() * 100)); // 80–180
      tempLast7.push(22 + Math.random() * 8);                  // 22–30 °C
    }

    // ---------------------------------------
    // Diagramm Flüge (Balken)
    // ---------------------------------------
    const ctxFlights = document.getElementById("flightsChart").getContext("2d");
    const flightsChart = new Chart(ctxFlights, {
      type: "bar",
      data: {
        labels: labelsLast7,
        datasets: [
          {
            label: "Flüge pro Tag",
            data: flightsLast7,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: { beginAtZero: true, ticks: { stepSize: 20 } },
        },
      },
    });

    // ---------------------------------------
    // Diagramm Temperatur (Linie)
    // ---------------------------------------
    const ctxTemp = document.getElementById("tempChart").getContext("2d");
    const tempChart = new Chart(ctxTemp, {
      type: "line",
      data: {
        labels: labelsLast7,
        datasets: [
          {
            label: "Ø Temperatur pro Tag (°C)",
            data: tempLast7,
            tension: 0.3,
            fill: false,
          },
        ],
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: false,
          },
        },
      },
    });

    // ---------------------------------------
    // Leaflet-Karte & Standort-Eingabe
    // ---------------------------------------
    const storedLat = localStorage.getItem("beeLocationLat");
    const storedLng = localStorage.getItem("beeLocationLng");

    let currentLat = storedLat ? parseFloat(storedLat) : 52.5200;
    let currentLng = storedLng ? parseFloat(storedLng) : 13.4050;

    document.getElementById("location-lat").innerText = currentLat.toFixed(4);
    document.getElementById("location-lng").innerText = currentLng.toFixed(4);
    document.getElementById("input-lat").value = currentLat.toFixed(4);
    document.getElementById("input-lng").value = currentLng.toFixed(4);

    map = L.map("map").setView([currentLat, currentLng], 13);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "© OpenStreetMap-Mitwirkende"
    }).addTo(map);

    const marker = L.marker([currentLat, currentLng])
      .addTo(map)
      .bindPopup("Hummelstock-Standort")
      .openPopup();

    document.getElementById("btn-update-location").addEventListener("click", () => {
      const latInput = parseFloat(document.getElementById("input-lat").value);
      const lngInput = parseFloat(document.getElementById("input-lng").value);

      if (isNaN(latInput) || isNaN(lngInput)) {
        alert("Bitte gültige Zahlen für Breite und Länge eingeben.");
        return;
      }

      currentLat = latInput;
      currentLng = lngInput;

      map.setView([currentLat, currentLng], 13);
      marker.setLatLng([currentLat, currentLng]);

      document.getElementById("location-lat").innerText = currentLat.toFixed(4);
      document.getElementById("location-lng").innerText = currentLng.toFixed(4);

      localStorage.setItem("beeLocationLat", currentLat.toFixed(4));
      localStorage.setItem("beeLocationLng", currentLng.toFixed(4));
    });

    // ---------------------------------------
    // UI updaten (Simulation der aktuellen Werte)
    // ---------------------------------------
    function updateSimulatedData() {
      flights += Math.floor(Math.random() * 4);
      temp += (Math.random() - 0.5) * 0.4;
      hum += (Math.random() - 0.5) * 1.0;

      if (temp < 15) temp = 15;
      if (temp > 35) temp = 35;
      if (hum < 30) hum = 30;
      if (hum > 90) hum = 90;

      document.getElementById("flights").innerText = flights;
      document.getElementById("temperature").innerText = temp.toFixed(1);
      document.getElementById("humidity").innerText = hum.toFixed(1);

      document.getElementById("flights-detail").innerText = flights;
      document.getElementById("temperature-detail").innerText = temp.toFixed(1);

      const tempStatus = document.getElementById("temp-status");
      if (temp >= 24 && temp <= 32) {
        tempStatus.innerText = "Temperatur im guten Bereich";
        tempStatus.className = "small status-ok";
      } else {
        tempStatus.innerText = "Temperatur außerhalb Optimalbereich";
        tempStatus.className = "small status-warn";
      }

      const humStatus = document.getElementById("hum-status");
      if (hum >= 50 && hum <= 80) {
        humStatus.innerText = "Luftfeuchtigkeit im guten Bereich";
        humStatus.className = "small status-ok";
      } else {
        humStatus.innerText = "Luftfeuchtigkeit außerhalb Optimalbereich";
        humStatus.className = "small status-warn";
      }
    }

    setInterval(updateSimulatedData, 2000);
    updateSimulatedData();
  </script>
</body>
</html>




